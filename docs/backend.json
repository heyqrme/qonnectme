{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile with personal information and preferences.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "username": {
          "type": "string",
          "description": "User's chosen username.",
          "format": "string"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name, can be different from username."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "bio": {
          "type": "string",
          "description": "User's biography or short description."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "themeId": {
          "type": "string",
          "description": "Reference to Theme. (Relationship: Theme 1:1 UserProfile)"
        },
        "qrCodeId": {
          "type": "string",
          "description": "Reference to QRCode. (Relationship: QRCode 1:1 UserProfile)"
        },
        "friendIds": {
          "type": "array",
          "description": "References to UserProfiles representing the user's friends. (Relationship: UserProfile N:N UserProfile)",
          "items": {
            "type": "string"
          }
        },
        "musicIds": {
          "type": "array",
          "description": "References to Musics. (Relationship: Music 1:N UserProfile)",
          "items": {
            "type": "string"
          }
        },
        "photoIds": {
          "type": "array",
          "description": "References to Photos. (Relationship: Photo 1:N UserProfile)",
          "items": {
            "type": "string"
          }
        },
        "videoIds": {
          "type": "array",
          "description": "References to Videos. (Relationship: Video 1:N UserProfile)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "username",
        "displayName",
        "email"
      ]
    },
    "QRCode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QRCode",
      "type": "object",
      "description": "Represents a unique QR code associated with a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the QRCode entity."
        },
        "qrCodeData": {
          "type": "string",
          "description": "The actual QR code data (e.g., URL or encoded information)."
        }
      },
      "required": [
        "id",
        "qrCodeData"
      ]
    },
    "Theme": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Theme",
      "type": "object",
      "description": "Represents a theme that defines the visual appearance of a user's profile.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Theme entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the theme (e.g., 'Dark Mode', 'Purple Haze')."
        },
        "primaryColor": {
          "type": "string",
          "description": "Hex code for the theme's primary color."
        },
        "backgroundColor": {
          "type": "string",
          "description": "Hex code for the theme's background color."
        },
        "accentColor": {
          "type": "string",
          "description": "Hex code for the theme's accent color."
        }
      },
      "required": [
        "id",
        "name",
        "primaryColor",
        "backgroundColor",
        "accentColor"
      ]
    },
    "Music": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Music",
      "type": "object",
      "description": "Represents a music file uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Music entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the music track."
        },
        "artist": {
          "type": "string",
          "description": "Artist of the music track."
        },
        "fileUrl": {
          "type": "string",
          "description": "URL of the music file.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "title",
        "artist",
        "fileUrl"
      ]
    },
    "Photo": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Photo",
      "type": "object",
      "description": "Represents a photo uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Photo entity."
        },
        "description": {
          "type": "string",
          "description": "Description of the photo."
        },
        "fileUrl": {
          "type": "string",
          "description": "URL of the photo file.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "fileUrl"
      ]
    },
    "Video": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Video",
      "type": "object",
      "description": "Represents a video uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Video entity."
        },
        "description": {
          "type": "string",
          "description": "Description of the video."
        },
        "fileUrl": {
          "type": "string",
          "description": "URL of the video file.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "fileUrl"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data. Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/qrCode",
        "definition": {
          "entityName": "QRCode",
          "schema": {
            "$ref": "#/backend/entities/QRCode"
          },
          "description": "Stores QR code data associated with a user. Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/theme",
        "definition": {
          "entityName": "Theme",
          "schema": {
            "$ref": "#/backend/entities/Theme"
          },
          "description": "Stores theme data for a user's profile. Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/musics/{musicId}",
        "definition": {
          "entityName": "Music",
          "schema": {
            "$ref": "#/backend/entities/Music"
          },
          "description": "Stores music uploaded by a user. Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "musicId",
              "description": "The unique identifier of the music file."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/photos/{photoId}",
        "definition": {
          "entityName": "Photo",
          "schema": {
            "$ref": "#/backend/entities/Photo"
          },
          "description": "Stores photos uploaded by a user. Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "photoId",
              "description": "The unique identifier of the photo."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/videos/{videoId}",
        "definition": {
          "entityName": "Video",
          "schema": {
            "$ref": "#/backend/entities/Video"
          },
          "description": "Stores videos uploaded by a user. Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "videoId",
              "description": "The unique identifier of the video."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the Qonnectme application. User profiles, themes, QR codes, music, photos, and videos are organized in a way that simplifies security rules and supports efficient data retrieval. This structure adheres to the core design principles, including Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters).\n\n1.  **UserProfile:** User profiles are stored under `/users/{userId}/profile`. This path-based ownership ensures that only the authenticated user can access and modify their profile data. No denormalization is required as the path inherently provides the authorization context. This satisfies the requirement for private data access.\n2.  **QRCode:** QR codes associated with user profiles are stored under `/users/{userId}/qrCode`. Similar to user profiles, path-based ownership is utilized, ensuring only the user can access their QR code. No denormalization is needed.\n3.  **Theme:** Themes are stored under `/users/{userId}/theme`. This continues the path-based ownership pattern, providing secure access to user-specific themes. No denormalization is required.\n4.  **Music, Photos, and Videos:** Music, photos, and videos uploaded by users are stored under `/users/{userId}/musics/{musicId}`, `/users/{userId}/photos/{photoId}`, and `/users/{userId}/videos/{videoId}` respectively. This hierarchical path structure maintains ownership and simplifies security rules. No denormalization is needed as the ownership is implicit in the path.\n\n**Authorization Independence and QAPs:**\n\n*   The path-based ownership model ensures that authorization is independent of the data content. Security rules can be written based solely on the path and the authenticated user's ID, without requiring `get()` calls to parent documents. This allows for atomic operations and easier debugging.\n*   Structural Segregation is used by separating user-specific data into dedicated subcollections under `/users/{userId}`. Each of these subcollections (profile, qrCode, theme, musics, photos, videos) has homogeneous security requirements, further simplifying the rules.\n*   QAPs are supported because list operations can be secured based on the path. For example, listing photos under `/users/{userId}/photos` only requires checking if the authenticated user ID matches the `{userId}` path parameter. Rules do not filter; they authorize or deny access based on the request's path and authentication state."
  }
}
    